<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <!-- Add this in the <head> section -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Add this before the closing </body> tag -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
    <!-- Add these links to your HTML file -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@12.0.0/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@12.0.0/dist/sweetalert2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>login</title>
</head>

<style>
    .copiedtext {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        text-align: center;
        opacity: 0;
        transform: translateY(-1em);
        color: #000;
        transition: all .500s;
    }

    .copied .copiedtext {
        opacity: 1;
        transform: translateY(-4em);
    }

    /* Some Generic styles */
    .body {
        text-align: center;
        font-family: "Open Sans", Helvetica, Arial, sans-serif;
        color: #444;
        line-height: 1.6;
    }

    .h1 {
        margin: 1.75em auto 1.25em;
    }


    [id="cleared"] {
        margin-top: 4em;
    }

    .button1 {
        font-size: 1em;
        font-family: "Open Sans", Helvetica, Arial, sans-serif;
        position: relative;
        padding: 8px 10px;
        border: 2px dotted black;
        font-size: 0.835em;
        text-transform: uppercase;
        letter-spacing: 0.125em;
        font-weight: bold;
        color: #000;
        background: #fff;
        transition: background .275s;
    }

    .button1:hover,
    .button1:focus {
        background: #e9e8e8;
        color: #fff;
        cursor: pointer;
    }
</style>

<body>
    <%- include ('navbar.ejs') %>
        <content>


            <div class="container-fluid d-flex justify-content-lg-center "
                style="padding-top: 5rem;" id="body-color">
                <div class="container-width ">
                    <%- include('sidebar.ejs') %>
                        <section class="home-section ">
                            <div class="profile-div3  bg-white  pt-3 d-flex justify-content-center">
                                <div class="w-100 box-shadows rounded-2 bg-white pt-1 pb-3 ps-2 profile-wallet">
                                    <div class="wallet-container d-flex justify-content-center">
                                        <div class=" wallet-head  " style=" ">
                                            <div class="wallet-head-div  d-flex justify-content-center"
                                                style="background-color: rgb(237, 241, 241);">
                                                Wallet
                                            </div>
                                            <div class="w-100 ">
                                                <div class="wallet-div2   d-flex align-items-center ">
                                                    <div class="wallet-image  d-flex  align-items-center">

                                                        <img src="/wallet.jpeg" style="border-radius: 50%;">


                                                    </div>
                                                    <div class="wallet-balance ">
                                                        <div class="w-100 h-25 d-flex justify-content-center">
                                                            <p class="heading">Balance</p>
                                                        </div>
                                                        <div class="w-100 h-75 d-flex justify-content-center ">
                                                            <h5>
                                                                <%= user.wallet.balance %>
                                                            </h5>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class=" body  h-auto  wallet-container2  mt-4">
                                        <div>
                                            <h1 class="w-100 heading">Refferel code</h1>
                                        </div>
                                        <div class="w-100 d-flex justify-content-center">
                                            <div class=" " style="width: 50%;  ">
                                                <p>Apply the refferel code of you frieds , get the perk of 100rs and
                                                    enjoy your shoping experience</p>
                                                <form id="referralForm">
                                                    
                                                      <%if(user.wallet.reffered == true){ %>
                                                        <input class="w-75 rounded-2"  style="height: 2rem;" contenteditable="false" placeholder="Reffered" >
                                                    <% } else{%>
                                                        <input class="w-75 rounded-2" style="height: 2rem;" type="text"
                                                        name="code">
                                                        <input type="hidden" name="userReferralCode"
                                                        value="<%= user.wallet.refferalcode %>">
                                                         <button class="btn btn-primary" type="button"
                                                          id="submitButton">Apply</button>
                                                    <%}%>
                                                </form>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="body m-3">
                                        <p>share your refferal code to frieds and family, let them enjoy the perks</p>
                                        <button class="button1" title="Copy promo code" id="copy"
                                            onClick="CopyToClipboard('to-copy')">
                                            <div id="to-copy">
                                                <%=user.wallet.refferalcode %>
                                            </div><span class="copiedtext" aria-hidden="true">Copied</span>
                                        </button>
                                        <p>click and copy</p>
                                    </div>


                                </div>
                            </div>
                        </section>
                </div>
            </div>
        </content>
        <footer>
            <div class="container-fluid footer-color">
                <div class="container d-flex ">
                    <div class="">
                        <div class="footer-div1 d-flex justify-content-center">
                            <h1 class="heading  pt-4">About us</h1>
                        </div>
                        <div class="footer-div1">

                            <p class="p-2">Welcome to Watch Universe, your ultimate destination for exquisite
                                timepieces. At Watch
                                Universe, we're passionate about bringing you the finest selection of watches that blend
                                elegance,
                                precision, and style.Our journey started with a love for craftsmanship and a desire to
                                share the world's
                                most stunning watches with watch enthusiasts and collectors alike.</p>

                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid footer-color d-flex justify-content-center">
                <p class="p-5">&copy; 2023 All rights reserved.Desined by Aneesh</p>
            </div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script>

            document.getElementById('submitButton').addEventListener('click', function () {
                const userReferralCode = document.querySelector('input[name="userReferralCode"]').value;
                const userEnteredReferralCode = document.querySelector('input[name="code"]').value;

                // Compare the entered code with the user's referral code
                if (userEnteredReferralCode === userReferralCode) {
                    return Swal.fire({
                        title: 'Invalid Refferal code',
                        text: 'You cant use your own refferal code',
                        icon: 'error',
                        
                    });

                }

                console.log("matched")
                const requestBody = {
                    userReferralCode: userReferralCode,
                    userEnteredReferralCode: userEnteredReferralCode
                };

                fetch('/refferalpost', {
                    method: 'POST',
                    body: JSON.stringify(requestBody),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => {
                        if (response.status === 200) {
                            return response.json();
                        } else if (response.status === 404) {
                            return response.json();
                        } else {
                            // Handle other errors here
                        }
                    })
                    .then(data => {
                        if (data.success) {
                            console.log("coming here");
                            Swal.fire({
                                title: 'Referral success',
                                text: '100rs added to the wallet',
                                icon: 'success',
                                
                            }).then(()=>{
                                window.location.reload()
                            })
                            
                        } else if (data.notfound) {
                            console.log("coming here");
                            Swal.fire({
                                title: 'Not found',
                                text: 'The given referral code was not found',
                                icon: 'error',
                            });
                        } else {
                            console.log(data.invalid);
                        }

                       
                    })
                    .catch(error => {

                    });

            });



            function CopyToClipboard(containerid) {
                var btnCopy = document.getElementById("copy");
                var main = document.getElementById("maincontent");
                // Create a new textarea element and give it id='temp_element'
                var textarea = document.createElement("textarea");
                textarea.id = "temp_element";
                // Optional step to make less noise on the page, if any!
                textarea.style.height = 0;
                // Now append it to your page somewhere, I chose <body>
                document.body.appendChild(textarea);
                // Give our textarea a value of whatever inside the div of id=containerid
                textarea.value = document.getElementById(containerid).innerText;
                // Now copy whatever inside the textarea to clipboard
                var selector = document.querySelector("#temp_element");
                selector.select();
                document.execCommand("copy");
                // Remove the textarea
                document.body.removeChild(textarea);
                // Add copied text after click
                if (document.execCommand("copy")) {
                    btnCopy.classList.add("copied");

                    var temp = setInterval(function () {
                        btnCopy.classList.remove("copied");
                        clearInterval(temp);
                    }, 600);

                } else {
                    console.info("document.execCommand went wrongâ€¦");
                }

            }
        </script>


</body>

</html>