<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css" class="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <title>product-managment</title>
</head>
<style>
    .error {
        color: red;
        font-size: 14px;
    }
</style>

<body>
    <%- include('navbar2.ejs') %>
        <content class="nav-height">
            <div class="container-fluid  ps-3 " id="body-color">
                <div class=" d-flex h-auto  profile-main">
                    <div class="profile-div ">
                        <div class="profile-photo d-flex align-items-center ">
                            <div class=" hii d-flex justify-content-center align-items-center">
                                <div class="profile-picture "
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/3001/3001764.png); background-repeat: no-repeat; background-size: cover;">
                                </div>
                            </div>
                            <div class=" hello d-flex align-items-center">
                                <span><a href="/admin"
                                        style="text-decoration: none; outline: none; color: black;">Admin</a></span>
                            </div>
                        </div>
                        <div class="profile-selection">
                            <div class="selector  d-flex align-items-center">
                                <div class=" hii d-flex align-items-center justify-content-center">
                                    <div class="selector-image"
                                        style="background-image: url(https://cdn-icons-png.flaticon.com/128/8089/8089114.png); ">
                                    </div>
                                </div>
                                <div class="hello d-flex align-items-center">
                                    <span><a href="/admin/orders"
                                            style="text-decoration: none; outline: none; color: black;">order
                                            details</a></span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="selector  d-flex align-items-center">
                                <div class=" hii  d-flex align-items-center justify-content-center">
                                    <div class="selector-image"
                                        style="background-image: url(https://cdn-icons-png.flaticon.com/128/4379/4379608.png); ">
                                    </div>
                                </div>
                                <div class=" hello d-flex align-items-center">
                                    <span><a href="/admin/product-managment"
                                            style="text-decoration: none; outline: none; color: black;">product</a></span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="selector  d-flex align-items-center align-items-center">
                                <div class="hii d-flex justify-content-center align-items-center">
                                    <div class="selector-image bg-light"
                                        style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                    </div>
                                </div>
                                <div class="hello d-flex align-items-center">
                                    <span><a href="/admin/user-managment"
                                            style="text-decoration: none; outline: none; color: black;">users</a></span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="selector  d-flex align-items-center align-items-center">
                                <div class="hii d-flex justify-content-center align-items-center">
                                    <div class="selector-image bg-light"
                                        style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                    </div>
                                </div>
                                <div class="hello d-flex align-items-center">
                                    <span><a href="/admin/category"
                                            style="text-decoration: none; outline: none; color: black;">category</a></span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="selector  d-flex align-items-center align-items-center"
                                style="background-color: rgb(246, 246, 246);">
                                <div class="hii d-flex justify-content-center align-items-center">
                                    <div class="selector-image bg-light"
                                        style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                    </div>
                                </div>
                                <div class="hello  d-flex align-items-center">
                                    <span><a href="/admin/coupon"
                                            style="text-decoration: none; outline: none; color: rgb(0, 0, 0);">coupon</a></span>
                                </div>
                            </div>
                            <div class="line"></div>
                            <div class="selector  d-flex align-items-center align-items-center">
                                <div class="hii d-flex justify-content-center align-items-center">
                                  <div class="selector-image bg-light"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); "></div>
                                </div>
                                <div class="hello d-flex align-items-center">
                                  <span><a href="/admin/banners"
                                      style="text-decoration: none; outline: none; color: black;">Banners</a></span>
                                </div>
                              </div>
                        </div>
                    </div>
                    <div class="profile-div2 p-3 ">
                        <div class="p-2">
                            <button type="button" class="btn btn-primary m-3" data-bs-toggle="modal"
                                data-bs-target="#exampleModal">
                                Add coupon
                            </button>

                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form action="/admin/coupon" method="post" onsubmit="return validateForm()">
                                                <div class="mb-3">
                                                    <label for="recipient-name" class="col-form-label">coupon
                                                        code:</label>
                                                    <input type="text"  name="coupon_code" class="form-control"
                                                        id="coupon-code">
                                                    <span class="error" id="coupon-code-error"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="message-text" class="col-form-label">coupon
                                                        type:</label>
                                                    <select name="coupon_type" class="form-control" id="coupon-type">
                                                        <option value="">Select a type</option>
                                                        <option value="flate">flate</option>
                                                        <option value="percent">percent</option>
                                                    </select>
                                                    <span class="error" id="coupon-type-error"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="message-text" class="col-form-label">coupon
                                                        value/percent:</label>
                                                    <input type="" name="coupon_value" class="form-control"
                                                        id="coupon-value">
                                                    <span class="error" id="coupon-value-error"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="mb-3">min:</label>
                                                    <input type="" name="min" class="form-control" id="min">
                                                    <span class="error" id="min-error"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="mb-3">max:</label>
                                                    <input type="" name="max" class="form-control" id="max">
                                                    <span class="error" id="max-error"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="message-text"
                                                        class="col-form-label">expire_date:</label>
                                                    <input type="date" name="coupon_date" class="form-control"
                                                        id="coupon-date">
                                                    <span class="error" id="coupon-date-error"></span>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Close</button>
                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                </div>
                            </div>



                            <table id="example" class="table table-striped " style="width:100%">
                                <thead>
                                    <tr>
                                        <th>No:</th>
                                        <th>coupon code</th>
                                        <th>coupon value</th>
                                        <th>coupon type</th>
                                        <th>minimum</th>
                                        <th>maximum</th>
                                        <th>expire date</th>
                                        <th>Active</th>
                                        <th>edit</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(let i=0; i< coupon.length;i++){ %>
                                        <tr>
                                            <td>
                                                <%= i+1 %>
                                            </td>
                                            <td>
                                                <%= coupon[i].coupon_code %>
                                            </td>
                                            <td>
                                                <%= coupon[i].coupon_value %>
                                            </td>
                                            <td>
                                                <%= coupon[i].coupon_type%>
                                            </td>
                                            <td>
                                                <%= coupon[i].min_amount %>
                                            </td>
                                            <td>
                                                <%=coupon[i].max_amount%>
                                            </td>
                                            <td>
                                                <% if (coupon[i].expire_date instanceof Date &&
                                                    !isNaN(coupon[i].expire_date)) { %>
                                                    <%= coupon[i].expire_date.toLocaleString() %>
                                                        <% } else { %>
                                                            N/A
                                                            <% } %>
                                            </td>
                                            <td>
                                                <% if (new Date(coupon[i].expire_date) < new Date()) { %>
                                                    Expired
                                                <% } else { %>
                                                    Active
                                                <% } %>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-primary m-3" data-bs-toggle="modal"
                                                data-bs-target="#exampleModal<%=i%>">
                                                edit
                                             </button>
                                             <div class="modal fade" id="exampleModal<%=i%>" tabindex="-1" aria-labelledby="exampleModalLabel"
                                             aria-hidden="true">
                                             <div class="modal-dialog">
                                                 <div class="modal-content">
                                                     <div class="modal-header">
                                                         <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                                                         <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                             aria-label="Close"></button>
                                                     </div>
                                                     <div class="modal-body">
                                                         <form action="/admin/couponedit" method="post"  onsubmit="return validateForm2('<%=i%>')">
                                                             <div class="mb-3">
                                                                 <label for="recipient-name" class="col-form-label">coupon
                                                                     code:</label>
                                                                 <input type="text" name="coupon_code" value="<%=coupon[i].coupon_code %>" placeholder="<%=coupon[i].coupon_code %>" class="form-control"
                                                                     id="coupon-code-<%=i%>">
                                                                     <input type="hidden" value="<%=coupon[i]._id %>"  name="id">
                                                                 <span class="error" id="coupon-code-error-<%=i%>"></span>
                                                             </div>
                                                             <div class="mb-3">
                                                                 <label for="message-text" class="col-form-label">coupon
                                                                     type:</label>
                                                                   
                                                                 <select name="coupon_type" class="form-control" id="coupon-type-<%=i%>">
                                                                     <%if(coupon[i].coupon_type == "flate") {%>
                                                                        <option value="flate" selected>flate</option>
                                                                        <option value="percent">percent</option>
                                                                    <% }else if(coupon[i].coupon_type == "percent"){%>
                                                                        <option value="percent" selected>percent</option>
                                                                        <option value="flate">flate</option>
                                                                  <%  }%>
                                                                 </select>
                                                                 <span class="error" id="coupon-type-error-<%=i%>"></span>
                                                             </div>
                                                             <div class="mb-3">
                                                                 <label for="message-text" class="col-form-label">coupon
                                                                     value/percent:</label>
                                                                 <input type="" name="coupon_value" value="<%=coupon[i].coupon_value %>" class="form-control" placeholder="<%=coupon[i].coupon_value %>"
                                                                     id="coupon-value-<%=i%>">
                                                                 <span class="error" id="coupon-value-error-<%=i%>"></span>
                                                             </div>
                                                             <div class="mb-3">
                                                                 <label class="mb-3">min:</label>
                                                                 <input type="" value="<%=coupon[i].min_amount%>" name="min" class="form-control"  placeholder="<%=coupon[i].min_amount%>" id="min-<%=i%>">
                                                                 <span class="error" id="min-error-<%=i%>"></span>
                                                             </div>
                                                             <div class="mb-3">
                                                                 <label class="mb-3">max:</label>
                                                                 <input type="" name="max" value="<%=coupon[i].max_amount%>"  placeholder="<%=coupon[i].max_amount%>" class="form-control" id="max-<%=i%>">
                                                                 <span class="error" id="max-error-<%=i%>"></span>
                                                             </div>
                                                             <div class="mb-3">
                                                                 <label for="message-text"
                                                                     class="col-form-label">expire_date: <%=coupon[i].expire_date%></label>
                                                                 <input type="date" value="" name="coupon_date" placeholder="<%=coupon[i].expire_date%>" class="form-control"
                                                                     id="coupon-date">
                                                                 <span class="error" id="coupon-date-error"></span>
                                                             </div>
                                                             <div class="modal-footer">
                                                                 <button type="button" class="btn btn-secondary"
                                                                     data-bs-dismiss="modal">Close</button>
                                                                 <button type="submit" class="btn btn-primary">Save changes</button>
                                                             </div>
                                                         </form>
             
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>
                
                                            </td>



                                        </tr>
                                        <% } %>

                                </tbody>

                            </table>

                        </div>


                    </div>
                </div>



        </content>

        <footer>
            <div class="container-fluid footer-color">
                <div class="container d-flex ">
                    <div class="">
                        <div class="footer-div1 d-flex justify-content-center">
                            <h1 class="heading  pt-4">About us</h1>
                        </div>
                        <div class="footer-div1">

                            <p class="p-2">Welcome to Watch Universe, your ultimate destination for exquisite
                                timepieces. At
                                Watch
                                Universe, we're passionate about bringing you the finest selection of watches that blend
                                elegance,
                                precision, and style.Our journey started with a love for craftsmanship and a desire to
                                share
                                the world's
                                most stunning watches with watch enthusiasts and collectors alike.</p>

                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid footer-color d-flex justify-content-center">
                <p class="p-5">&copy; 2023 All rights reserved.Desined by Aneesh</p>
            </div>
        </footer>

        <script>
            function validateForm() {
                // Reset error messages
                document.getElementById("coupon-code-error").textContent = "";
                document.getElementById("coupon-type-error").textContent = "";
                document.getElementById("coupon-value-error").textContent = "";
                document.getElementById("min-error").textContent = "";
                document.getElementById("max-error").textContent = "";
                document.getElementById("coupon-date-error").textContent = "";

                // Client-side validation
                const couponCode = document.getElementById("coupon-code").value.trim()
                const couponType = document.getElementById("coupon-type").value;
                const couponValue = parseFloat(document.getElementById("coupon-value").value.trim());
                const min = parseFloat(document.getElementById("min").value.trim());
                const max = parseFloat(document.getElementById("max").value.trim());
                const couponDate = document.getElementById("coupon-date").value;

                let hasErrors = false;

                if (!couponCode) {
                    console.log()
                    document.getElementById("coupon-code-error").textContent = "Coupon code is required.";
                    hasErrors = true;
                }


                if (!couponType) {
                    document.getElementById("coupon-type-error").textContent = "Coupon type is required.";
                    hasErrors = true;
                }



                if (isNaN(couponValue)) {
                    document.getElementById("coupon-value-error").textContent = "Coupon value is required";
                    hasErrors = true;
                }

                if (couponValue <= 0) {
                    document.getElementById("coupon-value-error").textContent = "coupon value should be greater than 0";
                    hasErrors = true;
                }


                if (isNaN(parseFloat(min))) {
                    document.getElementById("min-error").textContent = "Min value must be a number.";
                    hasErrors = true;
                }

                if (isNaN(parseFloat(max))) {
                    document.getElementById("max-error").textContent = "Max value must be a number.";
                    hasErrors = true;
                }


                if (!max) {
                    document.getElementById("max-error").textContent = "Maximum value required";
                    hasErrors = true;
                }


                if (!min) {
                    document.getElementById("min-error").textContent = "Mininum value required";
                    hasErrors = true;
                }




                if (!couponDate) {
                    document.getElementById("coupon-date-error").textContent = "Expiration date is required.";
                    hasErrors = true;
                } 
                if(couponDate) {
                   
                    const selectedDate = new Date(couponDate);

                    const today = new Date();

                    
                    if (selectedDate <= today) {
                        document.getElementById("coupon-date-error").textContent = "Expiration date must be in the future.";
                        hasErrors = true;
                    }
                }

                if (couponType === "percent" && (couponValue <= 0 || couponValue > 100)) {
                    document.getElementById("coupon-value-error").textContent = "Coupon percent must be between 1 and 100.";
                    hasErrors = true;
                }

                if (min >= max) {
                    document.getElementById("min-error").textContent = "Min must be less than max.";
                    hasErrors = true;
                }
                if (min >= max) {
                    document.getElementById("max-error").textContent = "Max must greater than min.";
                    hasErrors = true;
                }
                if (max <= 0) {
                    document.getElementById("max-error").textContent = "Max value must be greater than 0";
                    hasErrors = true;
                }
                if (min <= 0) {
                    document.getElementById("min-error").textContent = "Min value must be greater than 0";
                    hasErrors = true;
                }

                if (hasErrors) {
                    return false; // Prevent form submission
                }

           

                return true;
            }
            $(document).ready(function () {
                $('#example').DataTable({
                    searching: true // Enable searching
                });
            });

            function validateForm2(index) {
    // Reset error messages based on the index
    console.log(1)
    document.getElementById("coupon-code-error-" + index).textContent = "";
    document.getElementById("coupon-type-error-" + index).textContent = "";
    document.getElementById("coupon-value-error-" + index).textContent = "";
    document.getElementById("min-error-" + index).textContent = "";
    document.getElementById("max-error-" + index).textContent = "";
    console.log(2)

    const couponCode = document.getElementById("coupon-code-" + index).value.trim();
    const couponType = document.getElementById("coupon-type-" + index).value;
    const couponValue = parseFloat(document.getElementById("coupon-value-" + index).value.trim());
    const min = parseFloat(document.getElementById("min-" + index).value.trim());
    const max = parseFloat(document.getElementById("max-" + index).value.trim());
    
    console.log(3)


    let hasErrors = false;

    if (!couponCode) {
        document.getElementById("coupon-code-error-" + index).textContent = "Coupon code is required.";
        hasErrors = true;
    }
    console.log(4)

    if (!couponType) {
        document.getElementById("coupon-type-error-" + index).textContent = "Coupon type is required.";
        hasErrors = true;
    }
    console.log(5)

    if (isNaN(couponValue)) {
        document.getElementById("coupon-value-error-" + index).textContent = "Coupon value is required";
        hasErrors = true;
    }
    console.log(6)

    if (couponValue <= 0) {
        document.getElementById("coupon-value-error-" + index).textContent = "Coupon value should be greater than 0";
        hasErrors = true;
    }
    console.log(7)

    if (isNaN(min) || min <= 0) {
        document.getElementById("min-error-" + index).textContent = "Min value must be a positive number.";
        hasErrors = true;
    }
    console.log(7.1)

    if (isNaN(max) || max <= 0) {
        document.getElementById("max-error-" + index).textContent = "Max value must be a positive number.";
        hasErrors = true;
    }
    console.log(7)

    if (!max) {
        document.getElementById("max-error-" + index).textContent = "Maximum value required";
        hasErrors = true;
    }
    console.log(1.1)

    if (!min) {
        document.getElementById("min-error-" + index).textContent = "Minimum value required";
        hasErrors = true;
    }

 
    console.log(8)

   

    if (min >= max) {
        document.getElementById("min-error-" + index).textContent = "Min must be less than max.";
        hasErrors = true;
    }

    if (max <= 0) {
        document.getElementById("max-error-" + index).textContent = "Max value must be greater than 0";
        hasErrors = true;
    }

    if (min <= 0) {
        document.getElementById("min-error-" + index).textContent = "Min value must be greater than 0";
        hasErrors = true;
    }
    console.log(89)

    if (hasErrors) {
        return false;
    }



    return true; // Form submission allowed
}




        </script>

</body>




</html>