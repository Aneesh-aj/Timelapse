<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css" class="style">
  <title>login</title>
</head>

<body>
  <%- include('navbar.ejs') %>
    <content class="nav-height">
      <div class="container-fluid d-flex justify-content-center" id="body-color">
        <div class=" d-flex h-auto d-flex justify-content-center w-100 profile-main">
          <div class="profile-div ms-2 ">
            <div class="profile-photo d-flex align-items-center ">
              <div class=" hii d-flex justify-content-center align-items-center">
                <div class="profile-picture "
                  style="background-image: url(https://cdn-icons-png.flaticon.com/128/3001/3001764.png); background-repeat: no-repeat; background-size: cover;">
                </div>
              </div>
              <div class=" hello d-flex align-items-center">
                <span><a href="/admin" style="text-decoration: none; outline: none; color: black;">Admin</a></span>
              </div>
            </div>
            <div class="profile-selection">
              <div class="selector  d-flex align-items-center">
                <div class=" hii d-flex align-items-center justify-content-center">
                  <div class="selector-image"
                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/8089/8089114.png); "></div>
                </div>
                <div class="hello d-flex align-items-center">
                  <span><a href="/admin/orders" style="text-decoration: none; outline: none; color: black;">order
                      details</a></span>
                </div>
              </div>
              <div class="line"></div>
              <div class="selector  d-flex align-items-center">
                <div class=" hii  d-flex align-items-center justify-content-center">
                  <div class="selector-image"
                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/4379/4379608.png); "></div>
                </div>
                <div class=" hello d-flex align-items-center">
                  <span><a href="/admin/product-managment"
                      style="text-decoration: none; outline: none; color: black;">product</a></span>
                </div>
              </div>
              <div class="line"></div>
              <div class="selector  d-flex align-items-center align-items-center">
                <div class="hii d-flex justify-content-center align-items-center">
                  <div class="selector-image bg-light"
                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); "></div>
                </div>
                <div class="hello d-flex align-items-center">
                  <span><a href="/admin/user-managment"
                      style="text-decoration: none; outline: none; color: black;">users</a></span>
                </div>
              </div>
              <div class="line"></div>
              <div class="selector  d-flex align-items-center align-items-center">
                <div class="hii d-flex justify-content-center align-items-center">
                  <div class="selector-image bg-light"
                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); "></div>
                </div>
                <div class="hello d-flex align-items-center">
                  <span><a href="/admin/category"
                      style="text-decoration: none; outline: none; color: black;">category</a></span>
                </div>
              </div>
              <div class="line"></div>
              <div class="selector  d-flex align-items-center align-items-center">
                <div class="hii d-flex justify-content-center align-items-center">
                  <div class="selector-image bg-light"
                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); "></div>
                </div>
                <div class="hello d-flex align-items-center">
                  <span><a href="/admin/coupon"
                      style="text-decoration: none; outline: none; color: black;">coupon</a></span>
                </div>
              </div>
              <div class="line"></div>

            </div>
          </div>
          <div class="profile-div2 me-2 w-100  ">
            <div class="w-100  d-flex justify-content-evenly p-4" style="height: 14rem;">
              <div class="card box-shadows2" style="width: 18rem;">
                <div class="card-body  ">
                  <div class=" w-100 d-flex justify-content-center">
                    <h5 class="card-title mt-2 me-4"> Total users</h5>
                  </div>
                  <div class="-100 h-75 d-flex mt-2 justify-content-center align-items-center ">
                    <p class="count">
                      <%= users.length %>
                    </p>
                  </div>
                </div>
              </div>
              <div class="card box-shadows2" style="width: 18rem;">
                    <div class="card-body  ">
                  <div class=" w-100 d-flex justify-content-center">
                    <h5 class="card-title mt-2 me-4"> Total revenou</h5>

                  </div>
                  <div class="-100 h-75 d-flex mt-2 justify-content-center align-items-center ">
                    <p class="count">
                      <p class="count"><%=totalDeliveredAmount%></p>
                    </p>

                  </div>
                </div>
              </div>
              <div class="card box-shadows2" style="width: 18rem;">
                <div class="card-body  ">
                  <div class=" w-100 d-flex justify-content-center">
                    <h5 class="card-title mt-2 me-4"> Total Orders</h5>

                  </div>
                  <div class="-100 h-75 d-flex mt-2 justify-content-center align-items-center ">
                    <p class="count">
                      <%= totalorders.length %>
                    </p>

                  </div>
                </div>
              </div>
              <div class="card box-shadows2" style="width: 18rem;">
                <div class="card-body  ">
                  <div class=" w-100 d-flex justify-content-center">
                    <h5 class="card-title mt-2 me-4"> Total products</h5>
                  </div>
                  <div class="w-100 h-75 d-flex mt-2 justify-content-center align-items-center ">
                    <p class="count">
                      <%=products.length %>
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="m-5  me-5  d-flex justify-content-between">
              <select style="width: 5rem; height: 2rem;" id="yearSelect" onchange="onYearChange()">
                <% allYears.forEach(year=> { %>
                  <option value="<%= year %>">
                    <%= year %>
                  </option>
                  <% }); %>
              </select>
              <a href="/admin/salesreport" class="btn btn-primary">sales report</a>
            </div>
            <div class="d-flex ">
              <div class="ps-4 pe-5  " style="width: 90%;">
                <canvas id="myChart"></canvas>
              </div>

              <div class="ps-4 pe-5" style="width: 90%;">
                <canvas id="myAmountchart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </content>
    <footer>
      <div class="container-fluid footer-color">
        <div class="container d-flex ">
          <div class="">
            <div class="footer-div1 d-flex justify-content-center">
              <h1 class="heading  pt-4">About us</h1>
            </div>
            <div class="footer-div1">

              <p class="p-2">Welcome to Watch Universe, your ultimate destination for exquisite timepieces. At Watch
                Universe, we're passionate about bringing you the finest selection of watches that blend elegance,
                precision, and style.Our journey started with a love for craftsmanship and a desire to share the world's
                most stunning watches with watch enthusiasts and collectors alike.</p>

            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid footer-color d-flex justify-content-center">
        <p class="p-5">&copy; 2023 All rights reserved.Desined by Aneesh</p>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    <script>
      async function fetchData(year) {
        const response = await fetch('/admin/report', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ selectedYear: year }),
        });

        const data = await response.json();
        console.log("-----data", data);
        return data;
      }

      async function generateChart(selectedYear) {
        const data = await fetchData(selectedYear);

        console.log("inside ---data", data);

        // Use the selected year from the parameter
        console.log("selected year", data.allReports[selectedYear]);

        const values = data.allReports[selectedYear].monthlyOrders;
        const amount = data.allReports[selectedYear].monthlyAmounts;
        const returned = data.allReports[selectedYear].monthlyOrderReturned


        console.log("--next", values);
        console.log("----next2", amount);
        console.log("---next3", selectedYear);

        const months = [
          'January', 'February', 'March', 'April',
          'May', 'June', 'July', 'August',
          'September', 'October', 'November', 'December'
        ];

        const ctx = document.getElementById('myChart');
        const ctx2 = document.getElementById('myAmountchart');

        // Destroy existing chart instances
        Chart.getChart(ctx)?.destroy();
        Chart.getChart(ctx2)?.destroy();
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: months,
            datasets: [{
              label: 'Monthly Orders',
              data: values,
              fill: false,
              borderColor: 'rgb(75, 192, 192)',
              borderWidth: 1
            }, {
              label: 'Monthly Orders',
              data: returned,
              fill: false,
              borderColor: 'red',
              borderWidth: 1
            }],


          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          },
        });

        new Chart(ctx2, {
          type: 'line',
          data: {
            labels: months,
            datasets: [{
              label: 'Monthly Amounts',
              data: amount,
              fill: false,
              borderColor: 'rgb(75, 192, 192)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          },
        });
      }

      function onYearChange() {
        const yearSelect = document.getElementById('yearSelect');
        const selectedYear = yearSelect.value;
        generateChart(selectedYear);
      }

      const currentYear = new Date().getFullYear().toString();
      document.getElementById('yearSelect').value = currentYear;
      generateChart(currentYear); 
    </script>


</body>

</html>