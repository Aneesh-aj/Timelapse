<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css" class="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json2csv/5.0.5/json2csv.umd.min.js"></script>

    <title>product-managment</title>
</head>
<style>
    .sales-report{
  /* border: 1px solid grey; */
  border-radius: 12px;
  box-shadow:  5px 5px 10px rgba(0, 0, 0, 0.2); 
}

.sales-filter{
  /* border: 1px solid grey; */
  padding: 15px;
}

/* calendar */
.date-input {
  position: relative;
}
.custom-b{
  box-shadow: 0px 5px 5px rgba(0, 0, 0, 0.5);
  background-color: #003F62; /* Change to the color you prefer */
  color: #fff; /* Text color */
  padding: 10px 20px; /* Adjust padding as needed */
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s; /* Add a smooth transition effect */
}

.custom-b:hover {
  background-color: #FBBC05; /* Change to the hover color you prefer */
}







.date-input input[type="date"] {
  padding: 5px; /* Add padding for spacing */
  border: 1px solid #ccc; /* Add a border */
  border-radius: 5px; /* Rounded corners */
  background-color: #f4f4f4;
  color: #333; /* Text color */
  outline: none; /* Remove browser focus outline */
}
</style>

<body>
    <%- include('navbar3.ejs') %>
    <content class="nav-height">
        <div class="container-fluid   " id="body-color">
            <div class=" d-flex h-auto  profile-main">
                <div class="profile-div ">
                    <div class="profile-photo d-flex align-items-center ">
                        <div class=" hii d-flex justify-content-center align-items-center">
                            <div class="profile-picture "
                                style="background-image: url(https://cdn-icons-png.flaticon.com/128/3001/3001764.png); background-repeat: no-repeat; background-size: cover;">
                            </div>
                        </div>
                        <div class=" hello d-flex align-items-center">
                            <span><a href="/admin"
                                    style="text-decoration: none; outline: none; color: black;">Admin</a></span>
                        </div>
                    </div>
                    <div class="profile-selection">
                        <div class="selector  d-flex align-items-center" style="background-color: rgb(238, 236, 236);">
                            <div class=" hii d-flex align-items-center justify-content-center">
                                <div class="selector-image"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/8089/8089114.png); ">
                                </div>
                            </div>
                            <div class="hello d-flex align-items-center">
                                <span><a href="/admin/order-details"
                                        style="text-decoration: none; outline: none; color: black;">order
                                        details</a></span>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="selector  d-flex align-items-center">
                            <div class=" hii  d-flex align-items-center justify-content-center">
                                <div class="selector-image"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/4379/4379608.png); ">
                                </div>
                            </div>
                            <div class=" hello d-flex align-items-center">
                                <span><a href="/admin/product-managment"
                                        style="text-decoration: none; outline: none; color: black;">product</a></span>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="selector  d-flex align-items-center align-items-center">
                            <div class="hii d-flex justify-content-center align-items-center">
                                <div class="selector-image bg-light"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                </div>
                            </div>
                            <div class="hello d-flex align-items-center">
                                <span><a href="/admin/user-managment"
                                        style="text-decoration: none; outline: none; color: black;">users</a></span>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="selector  d-flex align-items-center align-items-center">
                            <div class="hii d-flex justify-content-center align-items-center">
                                <div class="selector-image bg-light"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                </div>
                            </div>
                            <div class="hello d-flex align-items-center">
                                <span><a href="/admin/category"
                                        style="text-decoration: none; outline: none; color: black;">category</a></span>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="selector  d-flex align-items-center align-items-center">
                            <div class="hii d-flex justify-content-center align-items-center">
                                <div class="selector-image bg-light"
                                    style="background-image: url(https://cdn-icons-png.flaticon.com/128/2435/2435281.png); ">
                                </div>
                            </div>
                            <div class="hello d-flex align-items-center">
                                <span><a href="/admin/coupon"
                                        style="text-decoration: none; outline: none; color: black;">coupon</a></span>
                            </div>
                        </div>
                        <div class="line"></div>

                    </div>
                </div>
                <div class="profile-div2  ">
                    <div class="sale-report-main mt-5 col-md-12 d-flex justify-content-center align-items-center">
                        <div class="sales-report align-items-center row">
                            <div class="sales-filter col" style=" text-align: center;">
                                <h3>Start date</h3>
                              
                                    <div class="date-input">
                                        <input type="date" id="startDate" name="startDate">
                                    </div>
                            </div>
            
                            <div class="sales-filter col" style=" text-align: center;">
                                <h3>End date</h3>
                                <div class="date-input">
                                    <input type="date" id="endDate" name="endDate">
                                </div>
            
                            </div>
                            <div class="d-flex justify-content-center" style="padding: 10px;">
                                <button class="custom-b" id="downloadButton" type="submit">Download report</button>
                            </div>
                     
                        </div>
                    </div>
                    <div class="m-5">
                      
                    



                        <table id="example" class="table table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th>No:</th>
                                    <th>order date</th>
                                    <th>order-id</th>
                                    <th>No.items</th>
                                    <th>Amount</th>
                                    <th>paymentMethod</th>
                                    <th>status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for(let i=0; i< order.length-1;i++){ %>
                                    <tr>
                                        <td>
                                            <%= i+1 %>   
                                        </td>
                                        
                                        <td><%= order[i].createdAt %></td>
                                        <td><%= order[i]._id%></td>
                                        <td><%= order[i].product.length %></td>
                                        <td><%= order[i].totalamount%></td>
                                        <td><%= order[i].paymentMethod %> </td>
                                          
                                        <td>
                                            <%= order[i].status %>
                                        </td>

                                    </tr>
                                    <% } %>

                            </tbody>

                        </table>

                    </div>


                </div>
            </div>



    </content>

    <footer>
        <div class="container-fluid footer-color">
            <div class="container d-flex ">
                <div class="">
                    <div class="footer-div1 d-flex justify-content-center">
                        <h1 class="heading  pt-4">About us</h1>
                    </div>
                    <div class="footer-div1">

                        <p class="p-2">Welcome to Watch Universe, your ultimate destination for exquisite timepieces. At
                            Watch
                            Universe, we're passionate about bringing you the finest selection of watches that blend
                            elegance,
                            precision, and style.Our journey started with a love for craftsmanship and a desire to share
                            the world's
                            most stunning watches with watch enthusiasts and collectors alike.</p>

                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid footer-color d-flex justify-content-center">
            <p class="p-5">&copy; 2023 All rights reserved.Desined by Aneesh</p>
        </div>
    </footer>

    <script>
        $(document).ready(function () {
            $('#example').DataTable({
                searching: true // Enable searching
            });
        });



        document.getElementById('downloadButton').addEventListener('click', () => {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
  console.log("before fetch")
    fetch(`/admin/download-salesReport?startDate=${startDate}&endDate=${endDate}`)
      .then((response) => response.json())
      .then((data) => {
        console.log(data);
        generateCSV(data);
      })
      .catch((error) => {
        console.error('Error:', error);
      });

});
// Updated generateCSV function
function generateCSV(data) {
  const fields = ["date", "orderId", "username", "paymentMethod", "totalAmount"];
  const opts = { fields };
  const json2csvParser = new json2csv.Parser(opts);

  try {
    const csv = json2csvParser.parse(data);
    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = window.URL.createObjectURL(blob);
    link.download = "sales_report.csv";
    link.click();
  } catch (error) {
    console.error("Error generating CSV: " + error);
  }
}


    </script>

</body>




</html>